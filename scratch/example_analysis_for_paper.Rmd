---
output:
  pdf_document: default
---

```{r, warning = FALSE, fig.width=12, cache=TRUE}
# Load "taxa" package
library(taxa)

# Look up plant occurrence data for Oregon
occ <- rgbif::occ_data(stateProvince = "Oregon",
                       scientificName = "Plantae")

# Parse data with taxa
obj <- parse_tax_data(occ$data,
                      class_cols = c("kingdom", "phylum", "order",
                                     "family", "genus", "specificEpithet"),
                      named_by_rank = TRUE)

# Plot number of occurrences for each taxon
obj %>% 
  filter_obs("tax_data", basisOfRecord == "PRESERVED_SPECIMEN",
             drop_taxa = TRUE) %>%
  filter_taxa(taxon_ranks != "specificEpithet") %>%
  filter_taxa(! is.na(taxon_names)) %>%
  filter_taxa(taxon_names == "Tracheophyta", subtaxa = TRUE) %>%
  filter_taxa(taxon_ranks == "order", n_subtaxa > 10,
              subtaxa = TRUE, supertaxa = TRUE) %>%
  metacoder::heat_tree(node_label = taxon_names,
                       node_color = n_obs,
                       node_size = n_obs,
                       node_color_axis_label = "Number of occurrences")
```

